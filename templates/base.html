<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Gestion Hôtelière{% endblock %}</title>
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style data-version="{{ cache_version }}">
        :root {
            --default-primary-color: #3498db;
            --default-sidebar-color: #2c3e50;

            --primary-color: {% if app_settings.primary_color %}{{ app_settings.primary_color }}{% else %}var(--default-primary-color){% endif %};
            --sidebar-color: {% if app_settings.sidebar_color %}{{ app_settings.sidebar_color }}{% else %}var(--default-sidebar-color){% endif %};
        }

        body {
            background-color: #f8f9fa;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        .sidebar {
            min-height: 100vh;
            background-color: var(--sidebar-color) !important;
            color: white !important;
            box-shadow: 2px 0 5px rgba(0, 0, 0, 0.1);
        }

        .sidebar a {
            color: rgba(255, 255, 255, 0.8);
            text-decoration: none;
            padding: 10px 15px;
            display: block;
            border-left: 3px solid transparent;
            transition: all 0.3s;
        }

        .sidebar a:hover,
        .sidebar a.active {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border-left-color: var(--primary-color);
        }

        .sidebar .brand {
            font-size: 1.5rem;
            font-weight: bold;
            padding: 20px;
            text-align: center;
            background: rgba(0, 0, 0, 0.2);
        }

        .main-content {
            padding: 20px;
        }

        .card {
            border: none;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            transition: transform 0.2s;
        }

        .card:hover {
            transform: translateY(-2px);
        }

        .status-badge {
            font-size: 0.8rem;
            padding: 5px 10px;
            border-radius: 20px;
        }

        .btn-primary {
            background-color: var(--primary-color) !important;
            border-color: var(--primary-color) !important;
        }

        .btn-primary:hover {
            background-color: var(--primary-color) !important;
            border-color: var(--primary-color) !important;
            opacity: 0.9;
        }

        .text-truncate-2 {
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
    </style>
</head>

<body>

    <div class="container-fluid">
        <div class="row">
            <!-- Sidebar -->
            <div class="col-md-2 sidebar p-0">
                <div class="brand text-center">
                    {% if app_settings.logo %}
                    <div class="mb-2">
                        <img src="{{ app_settings.logo.url }}?v={{ cache_version }}" alt="Logo" style="max-height: 50px; max-width: 100%;">
                    </div>
                    {% else %}
                    <div class="mb-2">
                        <i class="fa-solid fa-hotel" style="font-size: 2rem;"></i>
                    </div>
                    {% endif %}
                    <div class="hotel-name" style="font-size: 0.9rem; font-weight: 600; line-height: 1.2;">
                        {{ app_settings.hotel_name|default:"HotelMgr" }}
                    </div>
                </div>
                <div class="mt-3">
                    <a href="{% url 'dashboard' %}"
                        class="{% if request.resolver_match.url_name == 'dashboard' %}active{% endif %}">
                        <i class="fa-solid fa-gauge me-2"></i> Tableau de bord
                    </a>

                    <!-- Hotel Menu -->
                    <a href="#hotelSubmenu" data-bs-toggle="collapse"
                        class="d-flex justify-content-between align-items-center">
                        <span><i class="fa-solid fa-hotel me-2"></i> Hôtel</span>
                        <i class="fa-solid fa-chevron-down"></i>
                    </a>
                    <div class="collapse show" id="hotelSubmenu">
                        <div class="ps-4">
                            <a href="{% url 'reservation_list' %}"
                                class="{% if 'reservation' in request.resolver_match.url_name %}active{% endif %}">
                                <i class="fa-regular fa-calendar-check me-2"></i> Réservations
                            </a>
                            <a href="{% url 'client_list' %}"
                                class="{% if 'client' in request.resolver_match.url_name %}active{% endif %}">
                                <i class="fa-solid fa-users me-2"></i> Clients
                            </a>
                            <a href="{% url 'room_list' %}"
                                class="{% if request.resolver_match.url_name == 'room_list' %}active{% endif %}">
                                <i class="fa-solid fa-bed me-2"></i> Chambres
                            </a>
                        </div>
                    </div>

                    <!-- Restaurant Menu -->
                    <a href="#restaurantSubmenu" data-bs-toggle="collapse"
                        class="d-flex justify-content-between align-items-center">
                        <span><i class="fa-solid fa-utensils me-2"></i> Restaurant</span>
                        <i class="fa-solid fa-chevron-down"></i>
                    </a>
                    <div class="collapse" id="restaurantSubmenu">
                        <div class="ps-4">
                            <a href="{% url 'pos' %}"
                                class="{% if request.resolver_match.url_name == 'pos' %}active{% endif %}">
                                <i class="fa-solid fa-cash-register me-2"></i> POS
                            </a>
                            <a href="{% url 'order_list' %}"
                                class="{% if 'order_list' == request.resolver_match.url_name %}active{% endif %}">
                                <i class="fa-solid fa-utensils me-2"></i> Commandes
                            </a>
                            <a href="{% url 'menu_item_list' %}"
                                class="{% if 'menu_item' in request.resolver_match.url_name %}active{% endif %}">
                                <i class="fa-solid fa-book-open me-2"></i> Carte / Menu
                            </a>
                        </div>
                    </div>

                    <!-- Service Menu -->
                    <a href="#serviceSubmenu" data-bs-toggle="collapse"
                        class="d-flex justify-content-between align-items-center">
                        <span><i class="fa-solid fa-concierge-bell me-2"></i> Service</span>
                        <i class="fa-solid fa-chevron-down"></i>
                    </a>
                    <div class="collapse" id="serviceSubmenu">
                        <div class="ps-4">
                            <a href="{% url 'service_list' %}"
                                class="{% if 'service' in request.resolver_match.url_name %}active{% endif %}">
                                <i class="fa-solid fa-shirt me-2"></i> Blanchisserie
                            </a>
                            <a href="{% url 'transport_list' %}"
                                class="{% if 'transport' in request.resolver_match.url_name %}active{% endif %}">
                                <i class="fa-solid fa-van-shuttle me-2"></i> Transport
                            </a>
                            <a href="{% url 'room_cleaning_list' %}"
                                class="{% if 'room_cleaning' in request.resolver_match.url_name %}active{% endif %}">
                                <i class="fa-solid fa-broom me-2"></i> Nettoyage Chambres
                            </a>
                        </div>
                    </div>

                    <!-- Facturation Menu -->
                    <a href="#facturationSubmenu" data-bs-toggle="collapse"
                        class="d-flex justify-content-between align-items-center">
                        <span><i class="fa-solid fa-file-invoice-dollar me-2"></i> Facturation</span>
                        <i class="fa-solid fa-chevron-down"></i>
                    </a>
                    <div class="collapse" id="facturationSubmenu">
                        <div class="ps-4">
                            <a href="{% url 'invoice_list' %}"
                                class="{% if 'invoice' in request.resolver_match.url_name %}active{% endif %}">
                                <i class="fa-solid fa-list me-2"></i> Liste des Factures
                            </a>
                        </div>
                    </div>

                    <a href="{% url 'complaint_list' %}"
                        class="{% if 'complaint' in request.resolver_match.url_name %}active{% endif %}">
                        <i class="fa-solid fa-bullhorn me-2"></i> Plaintes
                    </a>

                    <!-- System Menu -->
                    <div class="mt-3 pt-3" style="border-top: 1px solid rgba(255,255,255,0.1);">
                        <a href="#systemSubmenu" data-bs-toggle="collapse"
                            class="d-flex justify-content-between align-items-center">
                            <span><i class="fa-solid fa-cog me-2"></i> Système</span>
                            <i class="fa-solid fa-chevron-down"></i>
                        </a>
                        <div class="collapse" id="systemSubmenu">
                            <div class="ps-4">
                                <a href="{% url 'user_list' %}">
                                    <i class="fa-solid fa-users-cog me-2"></i> Utilisateurs
                                </a>
                                <a href="{% url 'roles_permissions' %}">
                                    <i class="fa-solid fa-shield-halved me-2"></i> Rôles & Permissions
                                </a>
                                <a href="{% url 'branding' %}">
                                    <i class="fa-solid fa-palette me-2"></i> Apparence
                                </a>
                                <a href="{% url 'general_settings' %}">
                                    <i class="fa-solid fa-sliders me-2"></i> Paramètres
                                </a>
                                <a href="{% url 'log_list' %}">
                                    <i class="fa-solid fa-list-check me-2"></i> Logs & Historique
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Main Content -->
            <div class="col-md-10 main-content">
                <!-- Navbar -->
                <nav class="navbar navbar-expand-lg navbar-light bg-white rounded shadow-sm mb-4">
                    <div class="container-fluid">
                        <span class="navbar-brand mb-0 h1 fs-5">{% block header %}Tableau de bord{% endblock %}</span>
                        <div class="d-flex align-items-center gap-3">
                            <!-- Date and Time Display -->
                            <div class="text-muted small">
                                <i class="fa-regular fa-calendar me-1"></i>
                                <span id="currentDateTime"></span>
                            </div>
                            <div class="dropdown">
                                <button class="btn btn-light dropdown-toggle" type="button" id="userDropdown"
                                    data-bs-toggle="dropdown">
                                    <i class="fa-solid fa-user-circle me-1"></i> Admin
                                </button>
                                <ul class="dropdown-menu dropdown-menu-end">
                                    <li><a class="dropdown-item" href="#">Profil</a></li>
                                    <li>
                                        <hr class="dropdown-divider">
                                    </li>
                                    <li><a class="dropdown-item text-danger" href="{% url 'logout' %}">Déconnexion</a>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </nav>

                <!-- Page Content -->
                {% block content %}
                {% endblock %}
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    {% block extra_js %}{% endblock %}
    <script>
        // Update date and time every second
        function updateDateTime() {
            const now = new Date();
            const options = {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            };
            const dateTimeString = now.toLocaleDateString('fr-FR', options);
            document.getElementById('currentDateTime').textContent = dateTimeString;
        }

        // Update immediately and then every second
        updateDateTime();
        setInterval(updateDateTime, 1000);
    </script>
</body>

</html>